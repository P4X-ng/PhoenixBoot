00000000: 2321 2f75 7372 2f62 696e 2f65 6e76 2062  #!/usr/bin/env b
00000010: 6173 680a 2320 4465 7363 7269 7074 696f  ash.# Descriptio
00000020: 6e3a 2056 616c 6964 6174 6573 2074 6865  n: Validates the
00000030: 2070 7265 7365 6e63 6520 6f66 2053 6563   presence of Sec
00000040: 7572 6520 426f 6f74 2041 5554 4820 626c  ure Boot AUTH bl
00000050: 6f62 732e 0a0a 7365 7420 2d65 756f 2070  obs...set -euo p
00000060: 6970 6566 6169 6c0a 0a53 5243 5f44 4952  ipefail..SRC_DIR
00000070: 3d22 220a 6966 205b 202d 6620 6f75 742f  ="".if [ -f out/
00000080: 7365 6375 7265 7661 7273 2f50 4b2e 6175  securevars/PK.au
00000090: 7468 205d 2026 2620 5b20 2d66 206f 7574  th ] && [ -f out
000000a0: 2f73 6563 7572 6576 6172 732f 4b45 4b2e  /securevars/KEK.
000000b0: 6175 7468 205d 2026 2620 5b20 2d66 206f  auth ] && [ -f o
000000c0: 7574 2f73 6563 7572 6576 6172 732f 6462  ut/securevars/db
000000d0: 2e61 7574 6820 5d3b 2074 6865 6e0a 2020  .auth ]; then.  
000000e0: 2020 5352 435f 4449 523d 226f 7574 2f73    SRC_DIR="out/s
000000f0: 6563 7572 6576 6172 7322 0a65 6c69 6620  ecurevars".elif 
00000100: 5b20 2d66 2073 6563 7572 6562 6f6f 745f  [ -f secureboot_
00000110: 6365 7274 732f 504b 2e61 7574 6820 5d20  certs/PK.auth ] 
00000120: 2626 205b 202d 6620 7365 6375 7265 626f  && [ -f securebo
00000130: 6f74 5f63 6572 7473 2f4b 454b 2e61 7574  ot_certs/KEK.aut
00000140: 6820 5d20 2626 205b 202d 6620 7365 6375  h ] && [ -f secu
00000150: 7265 626f 6f74 5f63 6572 7473 2f64 622e  reboot_certs/db.
00000160: 6175 7468 205d 3b20 7468 656e 0a20 2020  auth ]; then.   
00000170: 2053 5243 5f44 4952 3d22 7365 6375 7265   SRC_DIR="secure
00000180: 626f 6f74 5f63 6572 7473 220a 656c 7365  boot_certs".else
00000190: 0a20 2020 2065 6368 6f20 22e2 9d8c 204d  .    echo "... M
000001a0: 6973 7369 6e67 2050 4b2f 4b45 4b2f 6462  issing PK/KEK/db
000001b0: 2041 5554 4820 626c 6f62 732e 2047 656e   AUTH blobs. Gen
000001c0: 6572 6174 6520 7769 7468 2027 6a75 7374  erate with 'just
000001d0: 206d 616b 652d 6175 7468 2720 6f72 2070   make-auth' or p
000001e0: 726f 7669 6465 2069 6e20 7365 6375 7265  rovide in secure
000001f0: 626f 6f74 5f63 6572 7473 2f22 0a20 2020  boot_certs/".   
00000200: 2065 7869 7420 310a 6669 0a0a 6563 686f   exit 1.fi..echo
00000210: 2022 e29c 8520 4155 5448 2062 6c6f 6273   "... AUTH blobs
00000220: 2066 6f75 6e64 2069 6e20 2453 5243 5f44   found in $SRC_D
00000230: 4952 220a 6c73 202d 6c20 2224 5352 435f  IR".ls -l "$SRC_
00000240: 4449 5222 2f7b 504b 2c4b 454b 2c64 627d  DIR"/{PK,KEK,db}
00000250: 2e61 7574 6820 323e 2f64 6576 2f6e 756c  .auth 2>/dev/nul
00000260: 6c20 7c7c 2074 7275 650a 0a              l || true..
